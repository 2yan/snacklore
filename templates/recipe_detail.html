{% extends "base.html" %}

{% block title %}{{ recipe.title }} - Snacklore{% endblock %}

{% block content %}
<div class="recipe-detail">
    <!-- Breadcrumb -->
    <div class="mb-1" style="font-size: 0.9rem;">
        <a href="{{ url_for('index') }}">Home</a> &gt; 
        <a href="{{ url_for('search_page', country=recipe.state.country.id) }}">{{ recipe.state.country.name }}</a> &gt; 
        <a href="{{ url_for('search_page', state=recipe.state.id) }}">{{ recipe.state.name }}</a> &gt; 
        <span>{{ recipe.title }}</span>
    </div>

    <div class="grid grid-2" style="grid-template-columns: 2fr 1fr; gap: 2rem;">
        <div class="main-content">
            <h1 style="margin-top: 0;">{{ recipe.title }}</h1>
            
            <div class="mb-1">
                By <a href="{{ url_for('user_profile_page', username=recipe.author.username) }}">{{ recipe.author.username }}</a>
                | ‚≠ê {{ recipe.get_score() }}
                {% if current_user.is_authenticated and current_user.id == recipe.author_id %}
                    | <a href="{{ url_for('edit_recipe_page', recipe_id=recipe.id) }}">Edit</a>
                {% endif %}
            </div>

            {% if recipe.image_url %}
                <img src="{{ recipe.image_url }}" alt="{{ recipe.title }}" style="width: 100%; border-radius: var(--squiggly-radius-2); border: 2px solid black; margin-bottom: 2rem;">
            {% endif %}

            {% if recipe.description %}
                <div class="squiggly-box mb-2" style="background: #f9f9f9;">
                    <p style="font-size: 1.3rem; font-style: italic;">{{ recipe.description }}</p>
                </div>
            {% endif %}

            <!-- Steps and Ingredients -->
            {% if recipe.steps %}
                <div class="steps-container">
                    <h2>Instructions</h2>
                    {% for step in recipe.steps %}
                        <div class="step squiggly-box mb-1">
                            <h3>Step {{ step.step_number }}</h3>
                            {% if step.duration_minutes %}
                                <p><em>Duration: {{ step.duration_minutes }} mins</em></p>
                            {% endif %}
                            
                            <p>{{ step.instruction }}</p>

                            {% if step.ingredients %}
                                <div class="step-ingredients" style="background: #eee; padding: 1rem; border-radius: var(--squiggly-radius-2); margin-top: 1rem;">
                                    <strong>Ingredients for this step:</strong>
                                    <ul>
                                    {% for ing in step.ingredients %}
                                        <li>{{ ing.quantity }} {{ ing.unit }} {{ ing.name }} {% if ing.notes %}({{ ing.notes }}){% endif %}</li>
                                    {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            
                            {% if step.image_url %}
                                <img src="{{ step.image_url }}" alt="Step {{ step.step_number }}" style="max-width: 100%; margin-top: 1rem; border-radius: var(--squiggly-radius-2); border: 1px solid black;">
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% elif recipe.instructions %}
                <!-- Fallback for text-only recipes -->
                <div class="squiggly-box">
                    <h2>Instructions</h2>
                    <div class="recipe-text">
                        {{ recipe.instructions|safe }}
                    </div>
                </div>
            {% endif %}
            
            <!-- Comments -->
            {% include 'includes/comment_component.html' %}
        </div>

        <div class="sidebar">
            <div class="squiggly-box mb-2" style="background: #fff0f0;">
                <h3 style="margin-top: 0;">At a Glance</h3>
                <ul style="list-style: none; padding: 0;">
                    <li><strong>Country:</strong> {{ recipe.state.country.name }}</li>
                    <li><strong>State/Region:</strong> {{ recipe.state.name }}</li>
                    <li><strong>Posted:</strong> {{ recipe.created_at.strftime('%Y-%m-%d') }}</li>
                </ul>
                
                <div class="mt-1 text-center">
                    <button class="btn btn-primary">Add to Favorites</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


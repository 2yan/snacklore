{% extends 'base.html' %}

{% block title %}New Recipe - Snacklore{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8">
    <div class="card p-8">
        <h1 class="font-cinzel text-3xl font-bold mb-6">Create New Recipe</h1>
        
        <form method="POST" class="space-y-6">
            <div class="space-y-2">
                <label for="name" class="text-sm font-medium">Recipe Name</label>
                <input type="text" name="name" id="name" required 
                       class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label for="country_id" class="text-sm font-medium">Country</label>
                    <select name="country_id" id="country_id" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        <option value="">Select Country</option>
                        {% for country in countries %}
                        <option value="{{ country.id }}" {% if current_user.primary_country_id == country.id %}selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="space-y-2">
                    <label for="state_id" class="text-sm font-medium">State/Region (Optional)</label>
                    <select name="state_id" id="state_id" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        <option value="">Select State</option>
                        <!-- States loaded via JS ideally, but empty for now -->
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary w-full">Create & Start Adding Steps</button>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
document.getElementById('country_id').addEventListener('change', function() {
    const countryId = this.value;
    const stateSelect = document.getElementById('state_id');
    
    if (!countryId) {
        stateSelect.innerHTML = '<option value="">Select State</option>';
        return;
    }
    
    fetch(`/api/states/${countryId}`)
        .then(response => response.json())
        .then(data => {
            stateSelect.innerHTML = '<option value="">Select State</option>';
            data.states.forEach(state => {
                const option = document.createElement('option');
                option.value = state.id;
                option.textContent = state.name;
                stateSelect.appendChild(option);
            });
        });
});
</script>
{% endblock %}
{% endblock %}

